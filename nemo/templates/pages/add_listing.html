{% extends "base.html" %}
{% block content %}

     <form method="POST" id="add_listing_form" action="" enctype="multipart/form-data">
         {% csrf_token %}
         <div>
                {{ form.street_address.label_tag}}
                {{ form.street_address }}
                {{ form.street_address.errors }}
         </div>
         <div>
                {{ form.city.label_tag}}
                {{ form.city }}
                {{ form.city.errors }}
         </div>
         <div>
                {{ form.state.label_tag}}
                {{ form.state }}
                {{ form.state.errors }}
         </div>
         <div>
                {{ form.postal_code.label_tag}}
                {{ form.postal_code }}
                {{ form.postal_code.errors }}
         </div>
         <div>
                {{ form.name.label_tag}}
                {{ form.name }}
                {{ form.name.errors }}
         </div>
         <div>
                {{ form.subcategory.label_tag}}
                {{ form.subcategory }}
                {{ form.subcategory.errors }}
         </div>
         <div>
                {{ form.description.label_tag}}
                {{ form.description }}
                {{ form.description.errors }}
         </div>
         <div>
                {{ form.price.label_tag}}
                {{ form.price }}
                {{ form.price.errors }}
         </div>
         <div id="image-uploader">
         </div>
         <div>
                {{ form.latitude }}
         </div>
         <div>
                {{ form.longitude }}
         </div>
         <div>
                {{ form.image_file }}
                {{ form.image_file.errors }}
         </div>
         <input type="button" value="Next" id="preview_add_listing_form">
     </form>
    <div id="add_listing_form_preview">
        <p>Review</p>
        <p><label>Item Location:</label><span id="preview_location"></span></p>
        <p><label>Title:</label><span id="preview_title"></span></p>
        <p><label>Category:</label><span id="preview_category"></span></p>
        <p><label>Description:</label><span id="preview_description"></span></p>
        <p><label>Price:</label> $ <span id="preview_price"></span> per Day</p>
        <p><label>Image:</label><img id="preview_image" /></p>
        <input type="button" value="Edit" id="edit_add_listing_form"/>
        <input type="button" value="Save & Submit" id="submit_add_listing_form"/>
    </div>

<script>
///////////////////////////  google autocomplete ////////////////////////////

var autocomplete;
var componentForm = {
  street_number: 'short_name',
  route: 'long_name',
  locality: 'long_name',
  administrative_area_level_1: 'short_name',
  postal_code: 'short_name'
};


function initialize() {
    autocomplete = new google.maps.places.Autocomplete(
            (document.getElementById('street_address')),
            {types: ['geocode'],
    });

    google.maps.event.addListener(autocomplete, 'place_changed', function() {
        fillInAddress();
    });
}

google.maps.event.addDomListener(window, 'load', initialize);
function getLatLngFromAddress(address) {
   var geocoder = new google.maps.Geocoder();
   geocoder.geocode({'address': address}, function(results, status) {
       if (status == google.maps.GeocoderStatus.OK) {
           $('#latitudes').val(results[0].geometry.location.lat())
           $('#longitudes').val(results[0].geometry.location.lng())
       } else {
           console.log("Geocode was not successful for the following reason: " + status);
       }
   });
}

function fillInAddress() {
    $("#city").val("");

    // Get the place details from the autocomplete object.
    var place = autocomplete.getPlace();
    for (var component in componentForm) {
       if (document.getElementById(component)) {
           document.getElementById(component).value = '';
           document.getElementById(component).disabled = false;
       }
    }

    // Get each component of the address from the place details
    // and fill the corresponding field on the form.
    var address = '';
    for (var i = 0; i < place.address_components.length; i++) {
       var addressType = place.address_components[i].types[0];

       if (componentForm[addressType]) {
           var val = place.address_components[i][componentForm[addressType]];
           if (addressType === "locality") {
            $("#city").val(val);
           }

           if (addressType === "postal_code") {
            $("#postal_code").val(val);
           }

           address = address + ' ' + val;

           if (document.getElementById(addressType)) {
               document.getElementById(addressType).value = val;
           }
       }
    }
    getLatLngFromAddress(address);
}
</script>

{% endblock %}

