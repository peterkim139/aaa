{% extends "base.html" %}
{% block content %}
<div style="float:left;">

    <p>
      <label for="amount">Price range:</label>
      <input type="text" id="amount" readonly style="border:0; color:#000; font-weight:bold;">
    </p>
    <div id="slider-range"></div>

    <form method="GET" action="">
        <input type="text" name="name" value="{{request.GET.name}}"/>
        <input type="hidden" name="start_range" id="start_range" value="{{request.GET.start_range}}">
        <input type="hidden" name="end_range" id="end_range" value="{{request.GET.end_range}}"><br>
        <!--{% if cats %}-->
            <!--{% for cat in cats %}-->
                <!--<input type="checkbox" name="category" id="option_{{cat.id}}" {% if cat.id in checked_categories %} checked="checked" {% endif %} value={{cat.id}} />-->
                <!--<label for="option_{{cat.id}}"><b>{{cat.name}}</b></label><br />-->
            <!--{% endfor %}-->
        <!--{% endif %}-->
        <input type="submit" id="search" value="Search">
    </form>

    {% if items and count > 0 %}
        {% for item in items %}
            <div class="item_details" data-id="{{ item.id }}" data-lat="{{ item.latitude }}" data-lng="{{ item.longitude }}">
                    <p class="item_name">{{ item.name }}</p>
                    <p class="item_description">{{ item.description }}</p>
                    <p class="item_price">{{ item.price }}</p>
                    <p class="item_distance">{{ item.distance }} miles away</p>
                    <img class="item_image" src="/media/images/items/{{ item.image_name }}"/>
            </div>
        {% endfor %}
    {% else %}
        <p>No results found.</p>
    {% endif %}
</div>
<div id="map_canvas" style="width : 500px; height: 1000px;float:right; "></div>
<script>
    ///////////price range slider jquery ui//////////////

    var start_range = '{{request.GET.start_range}}' ? '{{request.GET.start_range}}' : 0;
    var end_range = '{{request.GET.end_range}}' ? '{{request.GET.end_range}}' : {{ max_price }};
    var latitude = '{{latitude}}';
    var longitude = '{{longitude}}';


    $(function() {

        $( "#slider-range" ).slider({
          range: true,
          min: 0,
          max: {{max_price}},
          values: [ start_range, end_range ],
          slide: function( event, ui ) {
            $( "#amount" ).val( "$" + ui.values[ 0 ] + " - $" + ui.values[ 1 ] );
            $('#start_range').val(ui.values[ 0 ]);
            $('#end_range').val(ui.values[ 1 ]);
          }
        });

        $( "#amount" ).val( "$" + $( "#slider-range" ).slider( "values", 0 ) +
          " - $" + $( "#slider-range" ).slider( "values", 1 ) );
    });

    ///////////////////////   get location and init map //////////////////
    getLocation();
    initMap(latitude,longitude);

</script>
{% endblock %}